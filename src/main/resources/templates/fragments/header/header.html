<!-- âœ… ê°œì„ ëœ í—¤ë” Fragment -->
<div th:fragment="header" class="header">
  <!-- í—¤ë” ë°°ê²½ íš¨ê³¼ -->
  <div class="header-background">
    <div class="header-blur-overlay"></div>
    <div class="header-gradient-overlay"></div>
  </div>

  <!-- ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” í† ê¸€ ë²„íŠ¼ -->
  <button class="sidebar-toggle" onclick="toggleSidebar()">
    <div class="hamburger-container">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </div>
    <div class="toggle-glow"></div>
  </button>

  <!-- ì¢Œì¸¡ ë¡œê³  ì˜ì—­ -->
  <div class="header-logo">
    <a th:href="${#authorization.expression('hasRole(''ROLE_ADMIN'')')} ? @{/admin/users} : @{/user/main}" class="logo-link">
      <div class="logo-icon">
        <div class="logo-gradient">
          <span class="logo-emoji">ğŸ“Š</span>
          <div class="logo-shine"></div>
        </div>
        <div class="logo-ring"></div>
      </div>
      <div class="logo-text-wrapper">
        <span class="logo-text">CodeMap</span>
        <div class="logo-subtitle">Developer Journey</div>
      </div>
    </a>
  </div>

  <!-- ì¤‘ì•™ ë¹ˆ ê³µê°„ -->
  <div class="header-center"></div>

  <!-- ìš°ì¸¡ ì‚¬ìš©ì ì •ë³´ ì˜ì—­ -->
  <div class="header-actions" style="display: flex; align-items: center; gap: 16px; margin-right: 24px;">

    <!-- âœ… ì•Œë¦¼ ì•„ì´ì½˜ (ê¸°ì¡´ êµ¬ì¡°ì™€ í˜¸í™˜ë˜ë„ë¡) -->
    <div class="notification-wrapper" style="position: relative; display: flex; align-items: center;">
      <span id="notification-icon" style="font-size: 20px; cursor: pointer;">ğŸ””</span>
      <div id="notification-popup"></div> <!-- ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±° -->
    </div>

    <!-- ì‚¬ìš©ì ì •ë³´ -->
    <div class="user-info">
      <div class="user-avatar-wrapper">
        <div class="user-avatar" th:text="${user != null ? #strings.substring(user.nickname, 0, 1) : 'U'}">U</div>
        <div class="avatar-glow"></div>
        <div class="status-indicator"></div>
      </div>
      <div class="user-details">
        <span class="user-name" th:text="${user != null ? user.nickname : 'ì‚¬ìš©ì'}">ì‚¬ìš©ì</span>
        <div class="user-status">
          <div class="status-dot"></div>
          <span>ì˜¨ë¼ì¸</span>
        </div>
      </div>
    </div>

    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <form th:action="@{/user/logout}" method="post" class="logout-form">
      <button type="submit" class="action-btn logout-btn">
        <div class="btn-content">
          <div class="btn-icon">ğŸšª</div>
          <span class="btn-text">ë¡œê·¸ì•„ì›ƒ</span>
        </div>
        <div class="btn-hover-effect logout-effect"></div>
      </button>
    </form>
  </div>
</div>

<!-- âœ… í—¤ë” ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ -->
<script th:inline="javascript">
  /*<![CDATA[*/
  document.addEventListener('DOMContentLoaded', function() {
    // í—¤ë” ê³ ì •
    const header = document.querySelector('.header');
    if (header) {
      header.style.position = 'fixed';
      header.style.top = '0';
      header.style.left = '0';
      header.style.right = '0';
      header.style.zIndex = '9999';
      header.style.width = '100%';
    }

    // ì‚¬ì´ë“œë°” í† ê¸€
    window.toggleSidebar = function() {
      const sidebar = document.querySelector('.sidebar');
      const toggleBtn = document.querySelector('.sidebar-toggle');
      const body = document.body;

      if (sidebar && toggleBtn) {
        const isOpen = sidebar.classList.contains('open');

        if (isOpen) {
          sidebar.classList.remove('open');
          toggleBtn.classList.remove('active');
          body.classList.remove('sidebar-open');
        } else {
          sidebar.classList.add('open');
          toggleBtn.classList.add('active');
          body.classList.add('sidebar-open');
        }
      }
    };

    // ìŠ¤í¬ë¡¤ íš¨ê³¼
    let lastScrollY = window.scrollY;
    let ticking = false;

    function updateHeader() {
      const currentScrollY = window.scrollY;
      const header = document.querySelector('.header');

      if (header) {
        if (currentScrollY > 50) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      }

      lastScrollY = currentScrollY;
      ticking = false;
    }

    window.addEventListener('scroll', function() {
      if (!ticking) {
        requestAnimationFrame(updateHeader);
        ticking = true;
      }
    });

    // ë¦¬ì‚¬ì´ì¦ˆ
    let resizeTimer;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(function() {
        if (window.innerWidth > 768) {
          const sidebar = document.querySelector('.sidebar');
          const toggleBtn = document.querySelector('.sidebar-toggle');
          if (sidebar && toggleBtn) {
            sidebar.classList.remove('open');
            toggleBtn.classList.remove('active');
            document.body.classList.remove('sidebar-open');
          }
        }
      }, 250);
    });
  });
  /*]]>*/
</script>

<!-- âœ… ì•Œë¦¼ ìŠ¤í¬ë¦½íŠ¸ ì—°ê²° -->
<th:block th:replace="~{fragments/common/alert-script :: alert-script}" />
