<!-- ì‚¬ì´ë“œë°” Fragment -->
<div th:fragment="sidebar" class="sidebar">
  <!-- í”„ë¡œí•„ ì„¹ì…˜ -->
  <div class="sidebar-profile">
    <div class="profile-avatar">
      <div class="avatar-gradient">ğŸ‘¤</div>
      <div class="status-indicator"></div>
    </div>
    <div class="profile-info">
      <h3 class="profile-name">ê°œë°œìë‹˜</h3>
      <p class="profile-status">ì—´ì‹¬íˆ ì„±ì¥ ì¤‘ ğŸš€</p>
    </div>
  </div>

  <nav class="sidebar-nav">
    <!-- ë©”ì¸í™”ë©´ -->
    <a th:href="@{/user/main}" class="nav-item" data-nav="main">
      <div class="nav-icon-wrapper">
        <div class="nav-icon home-icon">ğŸ </div>
        <div class="icon-ripple"></div>
      </div>
      <span class="nav-text">ë©”ì¸í™”ë©´</span>
      <div class="nav-arrow">â†’</div>
    </a>

    <!-- íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸ -->
    <a th:href="@{/todos/calender}" class="nav-item" data-nav="todos">
      <div class="nav-icon-wrapper">
        <div class="nav-icon todo-icon">âœ…</div>
        <div class="icon-ripple"></div>
      </div>
      <span class="nav-text">íˆ¬ë‘ ë¦¬ìŠ¤íŠ¸</span>
      <div class="nav-arrow">â†’</div>
    </a>

    <!-- ë°ì¼ë¦¬ ë£¨í‹´ -->
    <a th:href="@{/routines}" class="nav-item" data-nav="routines">
      <div class="nav-icon-wrapper">
        <div class="nav-icon routine-icon">ğŸ¯</div>
        <div class="icon-ripple"></div>
      </div>
      <span class="nav-text">ë°ì¼ë¦¬ ë£¨í‹´</span>
      <div class="nav-arrow">â†’</div>
    </a>

    <!-- ì±„ìš©ê³µê³  -->
    <a th:href="@{/jobposting/list}" class="nav-item" data-nav="jobposting">
      <div class="nav-icon-wrapper">
        <div class="nav-icon job-icon">ğŸ’¼</div>
        <div class="icon-ripple"></div>
      </div>
      <span class="nav-text">ì±„ìš©ê³µê³ </span>
      <div class="nav-arrow">â†’</div>
    </a>

    <!-- ë©´ì ‘ ì§ˆë¬¸ -->
    <a th:href="@{/interview/select}" class="nav-item" data-nav="interview">
      <div class="nav-icon-wrapper">
        <div class="nav-icon interview-icon">ğŸ’¬</div>
        <div class="icon-ripple"></div>
      </div>
      <span class="nav-text">ë©´ì ‘ ì§ˆë¬¸</span>
      <div class="nav-arrow">â†’</div>
    </a>

    <!-- My í†µê³„ -->
    <a th:href="@{/mypage/stats}" class="nav-item" data-nav="stats">
      <div class="nav-icon-wrapper">
        <div class="nav-icon stats-icon">ğŸ“Š</div>
        <div class="icon-ripple"></div>
      </div>
      <span class="nav-text">My í†µê³„</span>
      <div class="nav-arrow">â†’</div>
    </a>

    <!-- í™˜ê²½ì„¤ì • -->
    <a th:href="@{/settings}" class="nav-item" data-nav="settings">
      <div class="nav-icon-wrapper">
        <div class="nav-icon settings-icon">âš™ï¸</div>
        <div class="icon-ripple"></div>
      </div>
      <span class="nav-text">í™˜ê²½ì„¤ì •</span>
      <div class="nav-arrow">â†’</div>
    </a>
  </nav>

  <!-- í•˜ë‹¨ ì •ë³´ -->
  <div class="sidebar-footer">
    <div class="progress-card">
      <div class="progress-header">
        <span class="progress-title">ì˜¤ëŠ˜ì˜ ì§„ì²™ë„</span>
        <span class="progress-percent">78%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 78%"></div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    const navItems = document.querySelectorAll('.nav-item');

    // ê²½ë¡œ ë§¤í•‘
    const pathMapping = {
      '/user/main': 'main',
      '/todos': 'todos',
      '/todos/calender': 'todos',
      '/routines': 'routines',
      '/jobposting/list': 'jobposting',
      '/interview/select': 'interview',
      '/mypage/stats': 'stats',
      '/settings': 'settings'
    };

    // í˜„ì¬ ê²½ë¡œì— ë”°ë¥¸ í™œì„±í™”
    let activeNav = pathMapping[currentPath];
    if (!activeNav) {
      for (const [path, nav] of Object.entries(pathMapping)) {
        if (currentPath.startsWith(path) && path !== '/') {
          activeNav = nav;
          break;
        }
      }
    }

    // í™œì„± ìƒíƒœ ì„¤ì •
    if (activeNav) {
      const activeItem = document.querySelector(`[data-nav="${activeNav}"]`);
      if (activeItem) {
        activeItem.classList.add('active');
      }
    }

    // í´ë¦­ ì´ë²¤íŠ¸ - ë¦¬í”Œ íš¨ê³¼ ì¶”ê°€
    navItems.forEach(item => {
      item.addEventListener('click', function(e) {
        navItems.forEach(nav => nav.classList.remove('active'));
        this.classList.add('active');

        // ë¦¬í”Œ íš¨ê³¼
        const ripple = this.querySelector('.icon-ripple');
        if (ripple) {
          ripple.style.animation = 'none';
          ripple.offsetHeight; // ë¦¬í”Œë¡œìš° ê°•ì œ
          ripple.style.animation = 'ripple 0.6s ease-out';
        }
      });
    });

    // ì§„ì²™ë„ ì• ë‹ˆë©”ì´ì…˜
    const progressFill = document.querySelector('.progress-fill');
    if (progressFill) {
      setTimeout(() => {
        progressFill.style.transition = 'width 1.5s ease-out';
      }, 500);
    }
  });

  // ëª¨ë°”ì¼ í† ê¸€ í•¨ìˆ˜
  function toggleSidebar() {
    const sidebar = document.querySelector('.sidebar');
    if (sidebar) {
      sidebar.classList.toggle('open');
    }
  }

  // ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸° (ëª¨ë°”ì¼ ì „ìš©)
  document.addEventListener('click', function(event) {
    const sidebar = document.querySelector('.sidebar');
    const toggleButton = document.querySelector('.sidebar-toggle');

    if (window.innerWidth <= 768 &&
        sidebar &&
        sidebar.classList.contains('open') &&
        !sidebar.contains(event.target) &&
        !toggleButton?.contains(event.target)) {
      sidebar.classList.remove('open');
    }
  });

  // ESC í‚¤ë¡œ ë‹«ê¸° (ëª¨ë°”ì¼ ì „ìš©)
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape' && window.innerWidth <= 768) {
      const sidebar = document.querySelector('.sidebar');
      if (sidebar && sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
      }
    }
  });
</script>

<style>
</style>