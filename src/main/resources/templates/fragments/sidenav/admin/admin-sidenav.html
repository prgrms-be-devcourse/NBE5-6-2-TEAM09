<!-- âœ… ê´€ë¦¬ì ì‚¬ì´ë“œë°” Fragment -->
<div th:fragment="sidebar" class="sidebar admin-sidebar">
  <!-- ê´€ë¦¬ì í”„ë¡œí•„ -->
  <div class="sidebar-header">
    <div class="admin-profile">
      <div class="admin-avatar">
        <img th:src="@{/img/user-circle.png}" alt="Admin Profile" />
      </div>
      <div class="admin-info">
        <div class="admin-name">ADMIN</div>
        <div class="admin-role">ê´€ë¦¬ì</div>
      </div>
    </div>
  </div>

  <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
  <nav class="sidebar-nav">
    <!-- íšŒì› ê´€ë¦¬ -->
    <a th:href="@{/admin/users}" class="nav-item" data-nav="users">
      <div class="nav-icon">
        <img th:src="@{/img/users.png}" alt="Users" />
      </div>
      <span class="nav-text">íšŒì› ê´€ë¦¬</span>
      <div class="nav-arrow">
        <img th:src="@{/img/chevron.png}" alt="Arrow" />
      </div>
      <div class="nav-indicator"></div>
    </a>

    <!-- ì»¨í…ì¸  ê´€ë¦¬ -->
    <a th:href="@{/admin/contents}" class="nav-item" data-nav="contents">
      <div class="nav-icon">
        <img th:src="@{/img/pencil-alt.png}" alt="Contents" />
      </div>
      <span class="nav-text">ì»¨í…ì¸  ê´€ë¦¬</span>
      <div class="nav-arrow">
        <img th:src="@{/img/chevron.png}" alt="Arrow" />
      </div>
      <div class="nav-indicator"></div>
    </a>

    <!-- êµ¬ë¶„ì„  -->
    <div class="nav-divider"></div>

    <!-- ì‹œìŠ¤í…œ ê´€ë¦¬ -->
    <a th:href="@{/admin/system}" class="nav-item" data-nav="system">
      <div class="nav-icon">âš™ï¸</div>
      <span class="nav-text">ì‹œìŠ¤í…œ ê´€ë¦¬</span>
      <div class="nav-arrow">
        <img th:src="@{/img/chevron.png}" alt="Arrow" />
      </div>
      <div class="nav-indicator"></div>
    </a>

    <!-- í†µê³„ -->
    <a th:href="@{/admin/statistics}" class="nav-item" data-nav="statistics">
      <div class="nav-icon">ğŸ“Š</div>
      <span class="nav-text">í†µê³„</span>
      <div class="nav-arrow">
        <img th:src="@{/img/chevron.png}" alt="Arrow" />
      </div>
      <div class="nav-indicator"></div>
    </a>
  </nav>
</div>

<!-- âœ… ê´€ë¦¬ì ì‚¬ì´ë“œë°” ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const currentPath = window.location.pathname;
    const navItems = document.querySelectorAll('.admin-sidebar .nav-item');

    // ê´€ë¦¬ì ê²½ë¡œ ë§¤í•‘
    const pathMapping = {
      '/admin/users': 'users',
      '/admin/contents': 'contents',
      '/admin/system': 'system',
      '/admin/statistics': 'statistics'
    };

    // í˜„ì¬ ê²½ë¡œì— ë”°ë¥¸ í™œì„±í™”
    let activeNav = pathMapping[currentPath];
    if (!activeNav) {
      for (const [path, nav] of Object.entries(pathMapping)) {
        if (currentPath.startsWith(path) && path !== '/') {
          activeNav = nav;
          break;
        }
      }
    }

    // í™œì„± ìƒíƒœ ì„¤ì •
    if (activeNav) {
      const activeItem = document.querySelector(`.admin-sidebar [data-nav="${activeNav}"]`);
      if (activeItem) {
        activeItem.classList.add('active');
      }
    }

    // í´ë¦­ ì´ë²¤íŠ¸ - ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼
    navItems.forEach(item => {
      item.addEventListener('click', function(e) {
        // ê¸°ì¡´ í™œì„± ìƒíƒœ ì œê±°
        navItems.forEach(nav => nav.classList.remove('active'));

        // ìƒˆë¡œìš´ í™œì„± ìƒíƒœ ì¶”ê°€
        this.classList.add('active');

        // ë¶€ë“œëŸ¬ìš´ í´ë¦­ íš¨ê³¼
        const icon = this.querySelector('.nav-icon');
        if (icon) {
          icon.style.transform = 'scale(0.95)';
          setTimeout(() => {
            icon.style.transform = '';
          }, 150);
        }
      });

      // í˜¸ë²„ íš¨ê³¼ ê°œì„ 
      item.addEventListener('mouseenter', function() {
        if (!this.classList.contains('active')) {
          this.style.transform = 'translateX(4px)';
        }
      });

      item.addEventListener('mouseleave', function() {
        if (!this.classList.contains('active')) {
          this.style.transform = '';
        }
      });
    });

    // ëª¨ë°”ì¼ì—ì„œ ë„¤ë¹„ê²Œì´ì…˜ í´ë¦­ì‹œ ì‚¬ì´ë“œë°” ë‹«ê¸°
    if (window.innerWidth <= 768) {
      navItems.forEach(item => {
        item.addEventListener('click', function() {
          setTimeout(() => {
            const sidebar = document.querySelector('.admin-sidebar');
            const toggleBtn = document.querySelector('.sidebar-toggle');
            if (sidebar && toggleBtn) {
              sidebar.classList.remove('open');
              toggleBtn.classList.remove('active');
              document.body.classList.remove('sidebar-open');
            }
          }, 200);
        });
      });
    }
  });

  // ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸° (ëª¨ë°”ì¼ ì „ìš©) - í—¤ë” ìŠ¤í¬ë¦½íŠ¸ì™€ ì¤‘ë³µ ë°©ì§€
  if (!window.adminSidebarClickHandlerAdded) {
    window.adminSidebarClickHandlerAdded = true;

    document.addEventListener('click', function(event) {
      const sidebar = document.querySelector('.admin-sidebar');
      const toggleButton = document.querySelector('.sidebar-toggle');

      if (window.innerWidth <= 768 &&
          sidebar &&
          sidebar.classList.contains('open') &&
          !sidebar.contains(event.target) &&
          !toggleButton?.contains(event.target)) {
        sidebar.classList.remove('open');
        toggleButton?.classList.remove('active');
        document.body.classList.remove('sidebar-open');
      }
    });

    // ESC í‚¤ë¡œ ë‹«ê¸° (ëª¨ë°”ì¼ ì „ìš©)
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && window.innerWidth <= 768) {
        const sidebar = document.querySelector('.admin-sidebar');
        const toggleButton = document.querySelector('.sidebar-toggle');
        if (sidebar && sidebar.classList.contains('open')) {
          sidebar.classList.remove('open');
          toggleButton?.classList.remove('active');
          document.body.classList.remove('sidebar-open');
        }
      }
    });
  }
</script>